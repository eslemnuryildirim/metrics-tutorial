apiVersion: 1
groups:
  - name: task5-cpu-alerts
    interval: 1m
    rules:
      - uid: task5_cpu_high
        title: "CPU Utilization High"
        condition: C
        data:
          - refId: A
            datasourceUid: prometheus
            model:
              expr: 100 * (1 - avg by (instance) (rate(node_cpu_seconds_total{mode="idle"}[5m])))
              intervalMs: 1000
              maxDataPoints: 43200
          - refId: C
            model:
              conditions:
                - evaluator:
                    type: gt
                    params: [200]
                  operator:
                    type: and
                  query:
                    refId: A
                  reducer:
                    type: last
                  type: query
        for: 5m
        annotations:
          summary: "CPU utilization > 200% for 5 minutes"
        labels:
          severity: critical

  - name: task5-memory-alerts
    interval: 1m
    rules:
      - uid: task5_mem_high
        title: "Memory Utilization High"
        condition: C
        data:
          - refId: A
            datasourceUid: prometheus
            model:
              expr: 100 * (1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes))
              intervalMs: 1000
              maxDataPoints: 43200
          - refId: C
            model:
              conditions:
                - evaluator:
                    type: gt
                    params: [90]
                  operator:
                    type: and
                  query:
                    refId: A
                  reducer:
                    type: last
                  type: query
        for: 1m
        annotations:
          summary: "Memory utilization > 90% for 1 minute"
        labels:
          severity: warning
